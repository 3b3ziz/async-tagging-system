# Async Tagging System

A learning project demonstrating asynchronous content tagging using AI, graph databases, and job queues. The system automatically processes and tags content using OpenAI, stores relationships in Neo4j, and provides recommendations based on graph relationships.

## Features

- **Async Task Processing:** Handles events via RabbitMQ for decoupling.
- **Tag Extraction:** Uses OpenAI API to extract relevant tags from post content.
- **Graph Storage:** Leverages Neo4j to store relationships between users, posts, and tags.

## Tech Stack

- **Technology Stack:** Node.js, TypeScript, Neo4j, RabbitMQ, OpenAI API.

## Project Structure

```
my-tagger/
├── .github/             # GitHub Actions workflows
├── .vscode/             # VSCode settings
├── jobs/                # Background job processing
│   ├── consumers/       # RabbitMQ consumers for events
│   ├── rabbitmqClient.ts # RabbitMQ client setup
│   └── startConsumers.ts # Entry point to start all consumers
├── lib/                 # Core libraries/utilities
│   ├── neo4j.ts         # Neo4j driver setup
│   ├── openai.ts        # OpenAI client setup
│   ├── rabbitmqConfig.ts # RabbitMQ configuration
│   ├── messageSchemas.ts # Zod schemas for RabbitMQ messages
│   └── schemas.ts       # Other shared Zod schemas (e.g., OpenAI response)
├── scripts/             # Utility scripts
├── simulation/          # Components for simulating a platform
│   ├── graph/           # Neo4j graph management
│   ├── mockData.json    # Mock data for testing
│   ├── mockPublisher.ts # Simulates publishing events to RabbitMQ
│   └── viewTags.ts      # Utility to view tags in Neo4j
├── viewer/              # React-based viewer application
│   └── server.ts        # Backend API server for the viewer app
├── .editorconfig
├── .env.sample          # Environment variable template
├── .env                 # Local environment variables (ignored by git)
├── .gitignore
├── docker-compose.yml   # Docker services (Neo4j, RabbitMQ)
├── package.json
├── pnpm-lock.yaml
├── README.md            # This file
└── tsconfig.json
```

**Simulation Directory (`simulation/`)**

The `simulation/` directory contains components used to *simulate* a social media platform generating events. This includes:
- A script to manage Neo4j graph data (`graph/reset.ts`).
- A script (`mockPublisher.ts`) to publish `post.created` and `post.interacted` events to RabbitMQ, mimicking how a real platform might notify downstream services.

This separation allows the core tagging service (`jobs/consumers/`) to be decoupled from the data source. The consumers only care about the messages received via RabbitMQ, not how they were generated.

## Getting Started

### Prerequisites

- Node.js (v18+ recommended)
- pnpm
- Docker & Docker Compose
- OpenAI API Key

### Running Locally

1.  **Setup Environment:**
    Copy `.env.sample` to `.env` and fill in your credentials (especially `OPENAI_API_KEY`, `NEO4J_URI`/`USERNAME`/`PASSWORD`, and `RABBITMQ_URL`).

2.  **Install Dependencies:**
    ```bash
    pnpm install
    ```

3.  **Start Services:**
    ```bash
    docker-compose up -d # Starts neo4j, rabbitmq
    ```

4. **(Optional) Reset Graph Database:**
   To clear existing graph data before testing:
   ```bash
   pnpm sim:graph:reset
   ```

5. **Start the Consumer Service:**
   This service listens for messages from RabbitMQ.
   ```bash
   pnpm start:consumers
   ```

6. **Run Simulation:**
   Run the mock publisher to send simulated events to RabbitMQ:
   ```bash
   pnpm sim:publish
   ```

### Monitoring

- **RabbitMQ Management:** Access the RabbitMQ Management UI (usually at `http://localhost:15672` with default credentials `guest`/`guest`).
- **Neo4j:** Neo4j Browser at `http://localhost:7474`

## Environment Variables

### Core
- `NODE_ENV`: Application environment (`development`, `production`, etc.)

### OpenAI
- `OPENAI_API_KEY`: Your OpenAI API key.

### RabbitMQ
- `RABBITMQ_URL`: RabbitMQ connection URL (e.g., `amqp://guest:guest@localhost:5672`)

### Neo4j
- `NEO4J_URI`: Neo4j connection URI (e.g., `neo4j://localhost:7687`)
- `NEO4J_USER`: Neo4j username
- `NEO4J_PASSWORD`: Neo4j password
- `NEO4J_DATABASE`: Neo4j database name (default: 'neo4j')

## Next Steps (Planned)
- [ ] User authentication
- [ ] Post creation and interaction UI
- [ ] Tag-based post recommendations
- [ ] Advanced graph visualizations
- [ ] API endpoints for post management

## Viewer App

A React-based viewer application is included to visualize posts and their tags. To use it:

1. Run the tagging system test cycle:
   ```
   pnpm test:cycle
   ```

2. Start the API server:
   ```
   pnpm viewer:server
   ```

3. In a separate terminal, start the React app:
   ```
   pnpm viewer
   ```

4. Open a browser and navigate to `http://localhost:3000`

The viewer displays posts from the mock data and shows the tags generated by OpenAI that are stored in Neo4j.